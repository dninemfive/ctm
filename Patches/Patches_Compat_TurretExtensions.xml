<?xml version="1.0" encoding="utf-8"?>
<Patch>
	<Operation Class="PatchOperationFindMod">
		<mods><li>[XND] Turret Extensions</li></mods>
		<match Class="PatchOperationSequence">
			<success>Always</success>
			<operations>
				<!-- targetable mini-turret -->
				<li Class="PatchOperationAttributeAdd">
					<xpath>*/ThingDef[defName = "Turret_MiniTurret"]</xpath>
					<attribute>Name</attribute>
					<value>Turret_MiniTurret</value>
				</li>
				<li Class="PatchOperationInsert">
					<xpath>*/ThingDef[defName = "Turret_MiniTurret"]</xpath>
					<value>
						<ThingDef ParentName="Turret_MiniTurret">
							<defName>Turret_MiniTurret_Targetable</defName>
							<label>targetable mini-turret</label>
							<description>A portable automatic turret. Requires steel to refurbish its barrel after heavy use. May explode when damaged. Constructed with a shackled AI persona core, it can be remotely targeted.</description>
							<comps Inherit="True">
								<li Class="TurretExtensions.CompProperties_SmartForcedTarget"/>
							</comps>
							<costList Inherit="False">
							  <Steel>40</Steel>
							  <ComponentIndustrial>3</ComponentIndustrial>
							  <ShackledAIPersona>1</ShackledAIPersona>
							</costList>
							<modExtensions>
								<li Class="TurretExtensions.TurretFrameworkExtension">
									<canForceAttack>true</canForceAttack>
								</li>
							</modExtensions>
						</ThingDef>
					</value>
				</li>
				<!-- targeted autocannon -->
				<li Class="PatchOperationInsert">
					<xpath>*/ThingDef[defName = "Turret_Autocannon"]</xpath>
					<value>
						<ThingDef ParentName="AutocannonTurret">
							<defName>Turret_Autocannon_Targetable</defName>
							<label>targetable autocannon turret</label>
							<description>A heavy automatic turret. Its large-caliber shells do heavy damage over significant ranges, but its barrel must be refurbished after use. It cannot fire at close-up targets, and may explode when damaged.\n\nConstructed with a shackled AI persona core, it can be remotely targeted.</description>
							<comps Inherit="True">
								<li Class="TurretExtensions.CompProperties_SmartForcedTarget"/>
							</comps>
							<costList Inherit="False">
							  <Steel>350</Steel>
							  <Plasteel>40</Plasteel>
							  <ComponentIndustrial>6</ComponentIndustrial>
							  <ShackledAIPersona>1</ShackledAIPersona>
							</costList>
							<modExtensions>
								<li Class="TurretExtensions.TurretFrameworkExtension">
									<canForceAttack>true</canForceAttack>
								</li>
							</modExtensions>
						</ThingDef>
					</value>
				</li>
				<!-- targeted sniper turret -->
				<li Class="PatchOperationAttributeAdd">
					<xpath>*/ThingDef[defName = "Turret_Sniper"]</xpath>
					<attribute>Name</attribute>
					<value>Turret_Sniper</value>
				</li>
				<li Class="PatchOperationInsert">
					<xpath>*/ThingDef[defName = "Turret_Sniper"]</xpath>
					<value>
						<ThingDef ParentName="Turret_Sniper">
							<defName>Turret_Sniper_Targetable</defName>
							<label>targetable sniper turret</label>
							<description>A long-ranged armor-piercing turret. Its ultra-dense uranium shells can punch through heavy armor at long ranges, but it requires new uranium slugs to be loaded after use. It's more accurate at longer ranges, and can't fire at all close up. May explode when damaged.\n\nConstructed with a shackled AI persona core, it can be remotely targeted.</description>
							<comps Inherit="True">
								<li Class="TurretExtensions.CompProperties_SmartForcedTarget"/>
							</comps>
							<costList Inherit="False">
							  <Steel>300</Steel>
							  <Plasteel>30</Plasteel>
							  <Uranium>60</Uranium>
							  <ComponentIndustrial>6</ComponentIndustrial>
							  <ShackledAIPersona>1</ShackledAIPersona>
							</costList>
							<modExtensions>
								<li Class="TurretExtensions.TurretFrameworkExtension">
									<canForceAttack>true</canForceAttack>
								</li>
							</modExtensions>
						</ThingDef>
					</value>
				</li>
				<!-- targetable charge (lance) turrets -->
				<li Class="PatchOperationInsert">
					<xpath>*/ThingDef[defName = "Turret_D9_ChargeRifles"]</xpath>
					<value>
						<ThingDef ParentName="Turret_D9_ChargeRifles">
							<defName>Turret_D9_ChargeRifles_Targetable</defName>
							<label>targetable charge rifle mini-turret</label>
							<description>A short-range portable automatic turret. Self-powered and needs no repair once placed. May rarely explode when damaged. Constructed with a shackled AI persona core, it can be remotely targeted.</description>
							<comps Inherit="True">
								<li Class="TurretExtensions.CompProperties_SmartForcedTarget"/>
							</comps>
							<costList Inherit="False">
							  <D9VanometricCell>4</D9VanometricCell>
							  <ShackledAIPersona>1</ShackledAIPersona>
							  <Plasteel>80</Plasteel>
							  <ComponentSpacer>3</ComponentSpacer>
							</costList>
							<modExtensions>
								<li Class="TurretExtensions.TurretFrameworkExtension">
									<canForceAttack>true</canForceAttack>
								</li>
							</modExtensions>
						</ThingDef>
					</value>
				</li>
				<li Class="PatchOperationInsert">
					<xpath>*/ThingDef[defName = "Turret_D9_ChargeLance"]</xpath>
					<value>
						<ThingDef ParentName="Turret_D9_ChargeLance">
							<defName>Turret_D9_ChargeLance_Targetable</defName>
							<label>targetable charge lance mini-turret</label>
							<description>A long-range portable automatic turret. Self-powered and needs no repair once placed. May rarely explode when damaged. Constructed with a shackled AI persona core, it can be remotely targeted.</description>
							<comps Inherit="True">
								<li Class="TurretExtensions.CompProperties_SmartForcedTarget"/>
							</comps>
							<costList Inherit="False">
							  <D9VanometricCell>2</D9VanometricCell>
							  <ShackledAIPersona>1</ShackledAIPersona>
							  <Gun_ChargeLance>1</Gun_ChargeLance>
							</costList>
							<modExtensions>
								<li Class="TurretExtensions.TurretFrameworkExtension">
									<canForceAttack>true</canForceAttack>
								</li>
							</modExtensions>
						</ThingDef>
					</value>
				</li>
				<!-- More Vanilla Turrets compat -->
				<li Class="PatchOperationFindMod">
					<mods><li>More Vanilla Turrets 1.0</li></mods>
					<match Class="PatchOperationSequence">
						<success>Always</success>
						<operations>
							<!-- ShredderTurretGun/BlastTurretGun not done to avoid bloat; their shorter range means targeting is less important, and these turrets have stuff costs so I can't stack them in dropdowns -->
							<!-- MilitaryTurretGun -->									
							<li Class="PatchOperationAttributeAdd">
								<xpath>*/ThingDef[defName = "MilitaryTurretGun"]</xpath>
								<attribute>Name</attribute>
								<value>MilitaryTurretGun</value>
							</li>
							<li Class="PatchOperationInsert">
								<xpath>*/ThingDef[defName = "MilitaryTurretGun"]</xpath>
								<value>
									<ThingDef ParentName="MilitaryTurretGun">
										<defName>MilitaryTurretGun_Targetable</defName>
										<label>targetable military-grade turret</label>
										<description>A more powerful variant of an automated turret. Longer dual barrels provide increased range, and greater burst. Has higher chance to explode in a radius of 4.\n\nConstructed with a shackled AI persona core, it can be remotely targeted.</description>
										<comps Inherit="True">
											<li Class="TurretExtensions.CompProperties_SmartForcedTarget"/>
										</comps>
										<costList Inherit="False">
										  <Steel>150</Steel>
										  <ComponentIndustrial>4</ComponentIndustrial>
										  <ShackledAIPersona>1</ShackledAIPersona>
										</costList>
										<modExtensions>
											<li Class="TurretExtensions.TurretFrameworkExtension">
												<canForceAttack>true</canForceAttack>
											</li>
										</modExtensions>
									</ThingDef>
								</value>
							</li>
							<!-- PrecisionTurretGun -->
							<li Class="PatchOperationAttributeAdd">
								<xpath>*/ThingDef[defName = "PrecisionTurretGun"]</xpath>
								<attribute>Name</attribute>
								<value>PrecisionTurretGun</value>
							</li>
							<li Class="PatchOperationInsert">
								<xpath>*/ThingDef[defName = "PrecisionTurretGun"]</xpath>
								<value>
									<ThingDef ParentName="PrecisionTurretGun">
										<defName>PrecisionTurretGun_Targetable</defName>
										<label>targetable precision turret</label>
										<description>A highly calibrated gun turret. Advanced optics allows it to deliver a single but precise shot at fairly long distances. Explodes rarely in a radius of 2.5.\n\nConstructed with a shackled AI persona core, it can be remotely targeted.</description>
										<comps Inherit="True">
											<li Class="TurretExtensions.CompProperties_SmartForcedTarget"/>
										</comps>
										<costList Inherit="False">
										  <Steel>225</Steel>
										  <ComponentIndustrial>5</ComponentIndustrial>
										  <ShackledAIPersona>1</ShackledAIPersona>
										</costList>
										<modExtensions>
											<li Class="TurretExtensions.TurretFrameworkExtension">
												<canForceAttack>true</canForceAttack>
											</li>
										</modExtensions>
									</ThingDef>
								</value>
							</li>
							<!-- VulcanCannon -->
							<li Class="PatchOperationAttributeAdd">
								<xpath>*/ThingDef[defName = "VulcanCannon"]</xpath>
								<attribute>Name</attribute>
								<value>VulcanCannon</value>
							</li>
							<li Class="PatchOperationInsert">
								<xpath>*/ThingDef[defName = "VulcanCannon"]</xpath>
								<value>
									<ThingDef ParentName="VulcanCannon">
										<defName>VulcanCannon_Targetable</defName>
										<label>targetable vulcan cannon</label>
										<description>Fortified minigun tower that fires continuously, very durable but power hungry. Its tall and has long range, but due to that it can't aim under itself and can't be placed indoors. Explodes in a radius of 5.1 when destroyed.\n\nConstructed with a shackled AI persona core, it can be remotely targeted.</description>
										<comps Inherit="True">
											<li Class="TurretExtensions.CompProperties_SmartForcedTarget"/>
										</comps>
										<costList Inherit="False">
										  <Steel>500</Steel>
										  <ComponentIndustrial>15</ComponentIndustrial>
										  <ShackledAIPersona>1</ShackledAIPersona>
										</costList>
										<modExtensions>
											<li Class="TurretExtensions.TurretFrameworkExtension">
												<canForceAttack>true</canForceAttack>
											</li>
										</modExtensions>
									</ThingDef>
								</value>
							</li>
						</operations>
					</match>
				</li>
			</operations>
		</match>
	</Operation>
</Patch>