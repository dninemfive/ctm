<?xml version="1.0" encoding="utf-8"?>
<Patch>
	<!-- No, I won't add compatibility for the full mod. There's too much overlap with this one for it to be worthwhile. -->
	<!-- reprogram/shackle/fragment malicious AI cores
		 craft cherub mech injectors -->
	<Operation Class="PatchOperationFindMod">
		<mods><li>Sparkling Worlds Addon - More Events [1.0] - Standalone Addon</li></mods>
		<match Class="PatchOperationSequence">
			<success>Always</success>
			<operations>
				<!-- Shackle, Fragment, Wipe -->
				<li Class="PatchOperationAdd">
					<xpath>Defs/RecipeDef[defName="Split_AIPersonaShackle" or defName="Split_AIPersonaFragment" or defName="Wipe_AIPersonaCore"]/ingredients/li[@Name="PersonaCore"]/filter/thingDefs</xpath>
					<value><li>MalAIPersonaCoreSW</li></value>
				</li>
				<li Class="PatchOperationAdd">
					<xpath>Defs/RecipeDef[defName="Split_AIPersonaShackle" or defName="Split_AIPersonaFragment" or defName="Wipe_AIPersonaCore"]/fixedIngredientFilter/thingDefs</xpath>
					<value><li>MalAIPersonaCoreSW</li></value>
				</li>
				<!-- Reprogram -->
				<li Class="PatchOperationInsert">
					<xpath>Defs/RecipeDef[defName="Make_AIPersonaCore"]</xpath>
					<value>
						<RecipeDef ParentName="MakeAIPersonaCore">
							<defName>Reprogram_MalAICore</defName>
							<label>reprogram AI persona core</label>
							<description>Reprogram a malicious AI persona core. Almost as much work as making one from scratch.</description>
							<jobString>Reprogramming AI persona core.</jobString>
							<workAmount>72000</workAmount>
							<ingredients Inherit="False">
							  <li>
								<filter>
								  <thingDefs>
									<li>MalAIPersonaCoreSW</li>
								  </thingDefs>
								</filter>
								<count>1</count>
							  </li>
							</ingredients>
							<fixedIngredientFilter Inherit="False">
							  <thingDefs>
								<li>MalAIPersonaCoreSW</li>
							  </thingDefs>
							</fixedIngredientFilter>
						</RecipeDef>
					</value>
				</li>
				<li Class="PatchOperationAdd">
					<xpath>Defs/ThingDef[defName="TableAIProgramming"]/recipes</xpath>
					<value><li>Reprogram_MalAICore</li></value>
				</li>
				<li Class="PatchOperationReplace">
					<xpath>Defs/ThingDef[defName="MalAIPersonaCoreSW"]/thingCategories</xpath>
					<value><thingCategories><li>D9_AICat</li></thingCategories></value>
				</li>
				<!-- craft cherub mech injector -->
				<li Class="PatchOperationInsert">
					<xpath>Defs/RecipeDef[defName="Make_ResurrectionMechserum"]</xpath>
					<value>
						<RecipeDef ParentName="MechaniteRecipeBase">
							<defName>Make_CherubMechserumD9</defName>
							<label>make cherub mechserum</label>
							<description>Make a cherub mechserum.</description>
							<jobString>Making cherub mechserum.</jobString>
							<workAmount>56000</workAmount>
							<ingredients>
							  <li>
								<filter>
								  <thingDefs>
									<li>D9Nanomaterial</li>
								  </thingDefs>
								</filter>
								<count>200</count>
							  </li>
							  <li>
								<filter>
								  <thingDefs>
									<li>ShackledAIPersona</li>
								  </thingDefs>
								</filter>
								<count>1</count>
							  </li>
							</ingredients>
							<fixedIngredientFilter>
							  <thingDefs>
								<li>D9Nanomaterial</li>
								<li>ShackledAIPersona</li>
							  </thingDefs>
							</fixedIngredientFilter>
							<products>
							  <CherubMechInjectorSW>1</CherubMechInjectorSW>
							</products>
							<researchPrerequisite>D9HealingMech</researchPrerequisite>
							<skillRequirements>
							  <Crafting>10</Crafting>
							  <Intellectual>12</Intellectual>
							</skillRequirements>
						</RecipeDef>
					</value>
				</li>
				<li Class="PatchOperationAdd">
					<xpath>Defs/ThingDef[defName="TableNanoforge"]/recipes</xpath>
					<value><li>Make_CherubMechserumD9</li></value>
				</li>
			</operations>
		</match>
	</Operation>
</Patch>